<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/topojson.v2.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
    <title>FCC Tree Map Challenge</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <script src="https://cdn.freecodecamp.org/testable-projects-fcc/v1/bundle.js"></script>
    <h1 id="title">Tree Maps are Useful!</h1>
    <div id="description">
      Video Game Sales
    </div>
    <div>
</div>

<script type="text/javascript">

const w = 2000
const h = 700
const margin = {top:30, bottom:30, left:30, right:30}
var data = d3.map();

// The svg
const svg = d3.select("body")
                  .append("svg")
                  .attr("width", w)
                  .attr("height", h)
                  .append("g");


//inspired from : https://stackoverflow.com/questions/15690706/recursively-looping-through-an-object-to-build-a-property-list

function decompose(obj,arr, id) {//decomposes and sorts through an object and outputs in an array
    for (var property in obj) {//iterating through object properties
        if (obj.hasOwnProperty(property)) {
            if (typeof obj[property] == "object") {
              decompose(obj[property],arr,id);
            }
            else if(obj.hasOwnProperty(property)){
              if(property === "name" && !obj.hasOwnProperty("children"))
                arr.push(Object.assign({}, obj, {id:id}));
            }
        }
    }
}

d3.queue()
  .defer(d3.json, "https://cdn.freecodecamp.org/testable-projects-fcc/data/tree_map/kickstarter-funding-data.json")
  .defer(d3.json, "https://cdn.freecodecamp.org/testable-projects-fcc/data/tree_map/movie-data.json")
  .defer(d3.json, "https://cdn.freecodecamp.org/testable-projects-fcc/data/tree_map/video-game-sales-data.json")
  .await(ready);

function ready(error,kickstarterPledges,movieSales,videoGameSales) {
    if(error)
    throw error;

    var ds1 = [], 
    ds2 = [] ,
    ds3 = []

    decompose(kickstarterPledges, ds1, "kickstarter")
    decompose(movieSales,ds2, "movie")
    decompose(videoGameSales,ds3, "videoG")

    dataset = ds1.concat(ds2).concat(ds3)

    console.log(ds1)
    console.log(ds2)
    console.log(ds3)
    
    console.log(dataset)

// const dataset = kickstarterPledges.children + movieSales.children + videoGameSales.children

// Array.prototype.push.apply(kickstarterPledges.children,movieSales.children);

// console.log(kickstarterPledges.children)

// console.log(kickstarterPledges.children.length + movieSales.children.length + videoGameSales.children.length)
// console.log(movieSales)
// console.log(videoGameSales)

// console.log(Object.keys(answers).length);

var root = d3.hierarchy(data).sum(function(d){ return d.value}) // Here the size of each leave is given in the 'value' field in input data
}
    </script>
</body>
</html>